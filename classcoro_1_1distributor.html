<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcoro: coro::distributor&lt; T, Lock &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libcoro
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Coroutine support library for C++20</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacecoro.html">coro</a></li><li class="navelem"><a class="el" href="classcoro_1_1distributor.html">distributor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classcoro_1_1distributor-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">coro::distributor&lt; T, Lock &gt; Class Template Reference<div class="ingroups"><a class="el" href="group__awaitable.html">Awaitables</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Distributes single event to multiple coroutines (subscribbers)  
 <a href="classcoro_1_1distributor.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="distributor_8h_source.html">distributor.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ad7967d46813c5eabba0ce5004255cacf"><td class="memTemplParams" colspan="2">template&lt;typename QueueImpl  = typename queue&lt;T&gt;::behavior&gt; </td></tr>
<tr class="memitem:ad7967d46813c5eabba0ce5004255cacf"><td class="memTemplItemLeft" align="right" valign="top">using&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#ad7967d46813c5eabba0ce5004255cacf">queue</a> = distributor_queue&lt; T, Lock, QueueImpl &gt;</td></tr>
<tr class="memdesc:ad7967d46813c5eabba0ce5004255cacf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements queue above distributor.  <a href="classcoro_1_1distributor.html#ad7967d46813c5eabba0ce5004255cacf">More...</a><br /></td></tr>
<tr class="separator:ad7967d46813c5eabba0ce5004255cacf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a531fc239d298e7e4b34cf87a31ff2025"><td class="memItemLeft" align="right" valign="top"><a id="a531fc239d298e7e4b34cf87a31ff2025"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#a531fc239d298e7e4b34cf87a31ff2025">distributor</a> ()=default</td></tr>
<tr class="memdesc:a531fc239d298e7e4b34cf87a31ff2025"><td class="mdescLeft">&#160;</td><td class="mdescRight">default constructor <br /></td></tr>
<tr class="separator:a531fc239d298e7e4b34cf87a31ff2025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5726ddff39fb4247d887d822230dc90"><td class="memItemLeft" align="right" valign="top"><a id="ae5726ddff39fb4247d887d822230dc90"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#ae5726ddff39fb4247d887d822230dc90">distributor</a> (Lock &amp;&amp;lk)</td></tr>
<tr class="memdesc:ae5726ddff39fb4247d887d822230dc90"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize lock instance <br /></td></tr>
<tr class="separator:ae5726ddff39fb4247d887d822230dc90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac51164397a931cf309a3dbd3e206d180"><td class="memTemplParams" colspan="2">template&lt;typename ... Args&gt; </td></tr>
<tr class="memitem:ac51164397a931cf309a3dbd3e206d180"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#ac51164397a931cf309a3dbd3e206d180">publish</a> (Args &amp;&amp;... args)</td></tr>
<tr class="memdesc:ac51164397a931cf309a3dbd3e206d180"><td class="mdescLeft">&#160;</td><td class="mdescRight">publish the value  <a href="classcoro_1_1distributor.html#ac51164397a931cf309a3dbd3e206d180">More...</a><br /></td></tr>
<tr class="separator:ac51164397a931cf309a3dbd3e206d180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8faf05d2a8aae8f2bc2a14628e3f07a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#a8faf05d2a8aae8f2bc2a14628e3f07a0">cancel_all</a> ()</td></tr>
<tr class="memdesc:a8faf05d2a8aae8f2bc2a14628e3f07a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">drops all subscribers  <a href="classcoro_1_1distributor.html#a8faf05d2a8aae8f2bc2a14628e3f07a0">More...</a><br /></td></tr>
<tr class="separator:a8faf05d2a8aae8f2bc2a14628e3f07a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a399379f391d8c1577923d5f5b235ae93"><td class="memItemLeft" align="right" valign="top"><a id="a399379f391d8c1577923d5f5b235ae93"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#a399379f391d8c1577923d5f5b235ae93">reject_all</a> (std::exception_ptr e)</td></tr>
<tr class="memdesc:a399379f391d8c1577923d5f5b235ae93"><td class="mdescLeft">&#160;</td><td class="mdescRight">reject all with exception <br /></td></tr>
<tr class="separator:a399379f391d8c1577923d5f5b235ae93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a151fe78ce593ec5c4b644b97b1d8d230"><td class="memItemLeft" align="right" valign="top"><a id="a151fe78ce593ec5c4b644b97b1d8d230"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#a151fe78ce593ec5c4b644b97b1d8d230">reject_all</a> ()</td></tr>
<tr class="memdesc:a151fe78ce593ec5c4b644b97b1d8d230"><td class="mdescLeft">&#160;</td><td class="mdescRight">reject all with current exception <br /></td></tr>
<tr class="separator:a151fe78ce593ec5c4b644b97b1d8d230"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7ca251aacef8245f0c07c335e38484c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classcoro_1_1future.html">future</a>&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#ac7ca251aacef8245f0c07c335e38484c">subscribe</a> (ID id={ })</td></tr>
<tr class="memdesc:ac7ca251aacef8245f0c07c335e38484c"><td class="mdescLeft">&#160;</td><td class="mdescRight">subscribe  <a href="classcoro_1_1distributor.html#ac7ca251aacef8245f0c07c335e38484c">More...</a><br /></td></tr>
<tr class="separator:ac7ca251aacef8245f0c07c335e38484c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a22a95f4363b7522e43dbec007ef338"><td class="memItemLeft" align="right" valign="top">pending_notify&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcoro_1_1distributor.html#a7a22a95f4363b7522e43dbec007ef338">drop</a> (ID id)</td></tr>
<tr class="memdesc:a7a22a95f4363b7522e43dbec007ef338"><td class="mdescLeft">&#160;</td><td class="mdescRight">drop single subscriber  <a href="classcoro_1_1distributor.html#a7a22a95f4363b7522e43dbec007ef338">More...</a><br /></td></tr>
<tr class="separator:a7a22a95f4363b7522e43dbec007ef338"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename T, typename Lock = nolock&gt;<br />
class coro::distributor&lt; T, Lock &gt;</h3>

<p>Distributes single event to multiple coroutines (subscribbers) </p>
<p>To use this object, a consument must subscribe itself at this object by calling <a class="el" href="classcoro_1_1distributor.html#ac7ca251aacef8245f0c07c335e38484c" title="subscribe">subscribe()</a> method. Return value is lazy_future. It must be awaited to finish subscribtion. To distribute event, you need to publish the event. The method resumes all registered coroutines.</p>
<p>Every subscription is one-shot. If the coroutine need to continue in subscription, it must re-call <a class="el" href="classcoro_1_1distributor.html#ac7ca251aacef8245f0c07c335e38484c" title="subscribe">subscribe()</a> right after resumption (in the same thread, without calling another <b>co_await</b>). If the subscriber need to process result asynchronously, it need to use <a class="el" href="classcoro_1_1distributor.html#ad7967d46813c5eabba0ce5004255cacf" title="Implements queue above distributor.">distributor::queue</a> to push received results to an queue, which can be also co_awaited</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>type which is payload of distribution. Can be reference </td></tr>
    <tr><td class="paramname">Lock</td><td>locking class. Default value disables locking for better performace. You need to set to std::mutex, if you need MT Safety </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00041">41</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="ad7967d46813c5eabba0ce5004255cacf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7967d46813c5eabba0ce5004255cacf">&#9670;&nbsp;</a></span>queue</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename Lock  = nolock&gt; </div>
<div class="memtemplate">
template&lt;typename QueueImpl  = typename queue&lt;T&gt;::behavior&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classcoro_1_1distributor.html">coro::distributor</a>&lt; T, Lock &gt;::<a class="el" href="classcoro_1_1distributor.html#ad7967d46813c5eabba0ce5004255cacf">queue</a> =  distributor_queue&lt;T, Lock, QueueImpl&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements queue above distributor. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Filter</td><td>specifies filter function. Filter function is called synchronously for the every item. It should return true to push item into queue, or false to discard the item. This can help with slow subscribers to control the queue size. For example, the function can skip unimportant events</td></tr>
    <tr><td class="paramname">QueueImpl</td><td>internal queue implementation</td></tr>
  </table>
  </dd>
</dl>
<p>You need to connect the object to a distributor </p>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00144">144</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a8faf05d2a8aae8f2bc2a14628e3f07a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8faf05d2a8aae8f2bc2a14628e3f07a0">&#9670;&nbsp;</a></span>cancel_all()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename Lock  = nolock&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classcoro_1_1distributor.html">coro::distributor</a>&lt; T, Lock &gt;::cancel_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>drops all subscribers </p>
<p>Subscribers are removed by receiving broken_promise. This allows to broadcast "end of stream" </p>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00073">73</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classcoro_1_1distributor_a8faf05d2a8aae8f2bc2a14628e3f07a0_icgraph.png" border="0" usemap="#aclasscoro_1_1distributor_a8faf05d2a8aae8f2bc2a14628e3f07a0_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a7a22a95f4363b7522e43dbec007ef338"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a22a95f4363b7522e43dbec007ef338">&#9670;&nbsp;</a></span>drop()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename Lock  = nolock&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pending_notify <a class="el" href="classcoro_1_1distributor.html">coro::distributor</a>&lt; T, Lock &gt;::drop </td>
          <td>(</td>
          <td class="paramtype">ID&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>drop single subscriber </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>identifier of subscriber </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pending_notify object, You can drop this object to finish operation, or you can schedule its drop operation. </dd></dl>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00111">111</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>

</div>
</div>
<a id="ac51164397a931cf309a3dbd3e206d180"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac51164397a931cf309a3dbd3e206d180">&#9670;&nbsp;</a></span>publish()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename Lock  = nolock&gt; </div>
<div class="memtemplate">
template&lt;typename ... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classcoro_1_1distributor.html">coro::distributor</a>&lt; T, Lock &gt;::publish </td>
          <td>(</td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>publish the value </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">args</td><td>arguments to construct payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>function is blocked until all subscribers are notified. </dd></dl>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00064">64</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>

</div>
</div>
<a id="ac7ca251aacef8245f0c07c335e38484c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7ca251aacef8245f0c07c335e38484c">&#9670;&nbsp;</a></span>subscribe()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename Lock  = nolock&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcoro_1_1future.html">future</a>&lt;T&gt; <a class="el" href="classcoro_1_1distributor.html">coro::distributor</a>&lt; T, Lock &gt;::subscribe </td>
          <td>(</td>
          <td class="paramtype">ID&#160;</td>
          <td class="paramname"><em>id</em> = <code>{&#160;}</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>subscribe </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>identifier of subsciber (optional) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>future which is resolved with distributed event </dd></dl>

<p class="definition">Definition at line <a class="el" href="distributor_8h_source.html#l00094">94</a> of file <a class="el" href="distributor_8h_source.html">distributor.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/coro/<a class="el" href="distributor_8h_source.html">distributor.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 17 2024 13:19:28 for libcoro by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
